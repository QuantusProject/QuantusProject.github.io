<!-- You must include this JavaScript file -->
<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<!-- For the full list of available Crowd HTML Elements and their input/output documentation,
      please refer to https://docs.aws.amazon.com/sagemaker/latest/dg/sms-ui-template-reference.html -->
<!-- You must include crowd-form so that your task submits answers to MTurk -->
<crowd-form answer-format="flatten-objects" style="height:100%">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
		integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<section class="container">
		<script type='text/javascript' src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'>
		</script>
		<!--/******************* TextHighlighter *******************/-->
		<script type="text/javascript">
			/******************* TextHighlighter *******************/
			/*
			The MIT License (MIT)
			
			Copyright (c) 2011 - 2014 mirz <mirz.hq@gmail.com>
			
			Permission is hereby granted, free of charge, to any person obtaining a copy
			of this software and associated documentation files (the "Software"), to deal
			in the Software without restriction, including without limitation the rights
			to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
			copies of the Software, and to permit persons to whom the Software is
			furnished to do so, subject to the following conditions:
			
			The above copyright notice and this permission notice shall be included in
			all copies or substantial portions of the Software.
			
			THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
			IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
			FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
			AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
			LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
			OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
			THE SOFTWARE.
			*/
			(function (l) {
				function t(a, b) { return e(a).color() === e(b).color() } function p(a, b) { a = a || {}; for (var c in b) b.hasOwnProperty(c) && void 0 === a[c] && (a[c] = b[c]); return a } function m(a) { return a.filter(function (a, c, d) { return d.indexOf(a) === c }) } function h(a, b) { a.sort(function (a, d) { return e(b ? d : a).parents().length - e(b ? a : d).parents().length }) } function v(a) {
					var b = [], c = {}, d = []; a.forEach(function (a) { var d = a.getAttribute("data-timestamp"); "undefined" === typeof c[d] && (c[d] = [], b.push(d)); c[d].push(a) }); b.forEach(function (a) {
						var b =
							c[a]; d.push({ chunks: b, timestamp: a, toString: function () { return b.map(function (a) { return a.textContent }).join("") } })
					}); return d
				} function w(a, b) { a.addEventListener("mouseup", b.highlightHandler.bind(b)); a.addEventListener("touchend", b.highlightHandler.bind(b)) } function g(a, b) {
					if (!a) throw "Missing anchor element"; this.el = a; this.options = p(b, { color: "#ffff7b", highlightedClass: "highlighted", contextClass: "highlighter-context", onRemoveHighlight: function () { return !0 }, onBeforeHighlight: function () { return !0 }, onAfterHighlight: function () { } });
					e(this.el).addClass(this.options.contextClass); w(this.el, this)
				} var u = "SCRIPT STYLE SELECT OPTION BUTTON OBJECT APPLET VIDEO AUDIO CANVAS EMBED PARAM METER PROGRESS".split(" "), e = function (a) {
					return {
						addClass: function (b) { a.classList ? a.classList.add(b) : a.className += " " + b }, removeClass: function (b) { a.classList ? a.classList.remove(b) : a.className = a.className.replace(new RegExp("(^|\\b)" + b + "(\\b|$)", "gi"), " ") }, prepend: function (b) { b = Array.prototype.slice.call(b); for (var c = b.length; c--;)a.insertBefore(b[c], a.firstChild) },
						append: function (b) { b = Array.prototype.slice.call(b); for (var c = 0, d = b.length; c < d; ++c)a.appendChild(b[c]) }, insertAfter: function (b) { return b.parentNode.insertBefore(a, b.nextSibling) }, insertBefore: function (b) { return b.parentNode.insertBefore(a, b) }, remove: function () { a.parentNode.removeChild(a); a = null }, contains: function (b) { return a !== b && a.contains(b) }, wrap: function (b) { a.parentNode && a.parentNode.insertBefore(b, a); b.appendChild(a); return b }, unwrap: function () {
							var b = Array.prototype.slice.call(a.childNodes), c;
							b.forEach(function (a) { c = a.parentNode; e(a).insertBefore(a.parentNode); e(c).remove() }); return b
						}, parents: function () { for (var b, c = []; b = a.parentNode;)c.push(b), a = b; return c }, normalizeTextNodes: function () { if (a) { if (3 === a.nodeType) for (; a.nextSibling && 3 === a.nextSibling.nodeType;)a.nodeValue += a.nextSibling.nodeValue, a.parentNode.removeChild(a.nextSibling); else e(a.firstChild).normalizeTextNodes(); e(a.nextSibling).normalizeTextNodes() } }, color: function () { return a.style.backgroundColor }, fromHTML: function (a) {
							var c =
								document.createElement("div"); c.innerHTML = a; return c.childNodes
						}, getRange: function () { var b = e(a).getSelection(), c; 0 < b.rangeCount && (c = b.getRangeAt(0)); return c }, removeAllRanges: function () { e(a).getSelection().removeAllRanges() }, getSelection: function () { return e(a).getWindow().getSelection() }, getWindow: function () { return e(a).getDocument().defaultView }, getDocument: function () { return a.ownerDocument || a }
					}
				}; g.prototype.destroy = function () {
					var a = this.el; a.removeEventListener("mouseup", this.highlightHandler.bind(this));
					a.removeEventListener("touchend", this.highlightHandler.bind(this)); e(this.el).removeClass(this.options.contextClass)
				}; g.prototype.highlightHandler = function () { this.doHighlight() }; g.prototype.doHighlight = function (a) { var b = e(this.el).getRange(), c, d; b && !b.collapsed && (!0 === this.options.onBeforeHighlight(b) && (d = +new Date, c = g.createWrapper(this.options), c.setAttribute("data-timestamp", d), c = this.highlightRange(b, c), c = this.normalizeHighlights(c), this.options.onAfterHighlight(b, c, d)), a || e(this.el).removeAllRanges()) };
				g.prototype.highlightRange = function (a, b) {
					var c; if (!a || a.collapsed) return []; var d = a.startContainer; c = a.endContainer; var r = a.commonAncestorContainer, n = !0; if (0 === a.endOffset) { for (; !c.previousSibling && c.parentNode !== r;)c = c.parentNode; c = c.previousSibling } else 3 === c.nodeType ? a.endOffset < c.nodeValue.length && c.splitText(a.endOffset) : 0 < a.endOffset && (c = c.childNodes.item(a.endOffset - 1)); 3 === d.nodeType ? a.startOffset === d.nodeValue.length ? n = !1 : 0 < a.startOffset && (d = d.splitText(a.startOffset), c === d.previousSibling &&
						(c = d)) : d = a.startOffset < d.childNodes.length ? d.childNodes.item(a.startOffset) : d.nextSibling; var f = n, n = !1, r = [], k; do f && 3 === d.nodeType && (-1 === u.indexOf(d.parentNode.tagName) && "" !== d.nodeValue.trim() && (f = b.cloneNode(!0), f.setAttribute("data-highlighted", !0), k = d.parentNode, e(this.el).contains(k) || k === this.el) && (f = e(d).wrap(f), r.push(f)), f = !1), d !== c || c.hasChildNodes() && f || (n = !0), d.tagName && -1 < u.indexOf(d.tagName) && (c.parentNode === d && (n = !0), f = !1), f && d.hasChildNodes() ? d = d.firstChild : d.nextSibling ? (d = d.nextSibling,
							f = !0) : (d = d.parentNode, f = !1); while (!n); return r
				}; g.prototype.normalizeHighlights = function (a) { this.flattenNestedHighlights(a); this.mergeSiblingHighlights(a); a = a.filter(function (a) { return a.parentElement ? a : null }); a = m(a); a.sort(function (a, c) { return a.offsetTop - c.offsetTop || a.offsetLeft - c.offsetLeft }); return a }; g.prototype.flattenNestedHighlights = function (a) {
					function b() {
						var b = !1; a.forEach(function (c, f) {
							var k = c.parentElement, g = k.previousSibling, h = k.nextSibling; d.isHighlight(k) && (t(k, c) ? (k.replaceChild(c.firstChild,
								c), a[f] = k, b = !0) : (c.nextSibling || (e(c).insertBefore(h || k), b = !0), c.previousSibling || (e(c).insertAfter(g || k), b = !0), k.hasChildNodes() || e(k).remove()))
						}); return b
					} var c, d = this; h(a, !0); do c = b(); while (c)
				}; g.prototype.mergeSiblingHighlights = function (a) { function b(a, b) { return b && 1 === b.nodeType && t(a, b) && c.isHighlight(b) } var c = this; a.forEach(function (a) { var c = a.previousSibling, n = a.nextSibling; b(a, c) && (e(a).prepend(c.childNodes), e(c).remove()); b(a, n) && (e(a).append(n.childNodes), e(n).remove()); e(a).normalizeTextNodes() }) };
				g.prototype.setColor = function (a) { this.options.color = a }; g.prototype.getColor = function () { return this.options.color }; g.prototype.removeHighlights = function (a) { function b(a) { e(a).unwrap().forEach(function (a) { var b = a.previousSibling, c = a.nextSibling; b && 3 === b.nodeType && (a.nodeValue = b.nodeValue + a.nodeValue, e(b).remove()); c && 3 === c.nodeType && (a.nodeValue += c.nodeValue, e(c).remove()) }) } a = this.getHighlights({ container: a || this.el }); var c = this; h(a, !0); a.forEach(function (a) { !0 === c.options.onRemoveHighlight(a) && b(a) }) };
				g.prototype.getHighlights = function (a) { a = p(a, { container: this.el, andSelf: !0, grouped: !1 }); var b = a.container.querySelectorAll("[data-highlighted]"), b = Array.prototype.slice.call(b); !0 === a.andSelf && a.container.hasAttribute("data-highlighted") && b.push(a.container); a.grouped && (b = v(b)); return b }; g.prototype.isHighlight = function (a) { return a && 1 === a.nodeType && a.hasAttribute("data-highlighted") }; g.prototype.serializeHighlights = function () {
					var a = this.getHighlights(), b = this.el, c = []; h(a, !1); a.forEach(function (a) {
						var e =
							0, g = a.textContent.length, f = a, k = [], h; do h = Array.prototype.slice.call(f.parentNode.childNodes), k.unshift(h.indexOf(f)), f = f.parentNode; while (f !== b || !f); f = a.cloneNode(!0); f.innerHTML = ""; f = f.outerHTML; a.previousSibling && 3 === a.previousSibling.nodeType && (e = a.previousSibling.length); c.push([f, a.textContent, k.join(":"), e, g])
					}); return JSON.stringify(c)
				}; g.prototype.deserializeHighlights = function (a) {
					var b, c = [], d = this; if (!a) return c; try { b = JSON.parse(a) } catch (g) { throw "Can't parse JSON: " + g; } b.forEach(function (a) {
						try {
							for (var b =
								a[0], g = a[2].split(":"), h = a[3], m = a[4], l = g.pop(), s = d.el, q, p, r; r = g.shift();)s = s.childNodes[r]; s.childNodes[l - 1] && 3 === s.childNodes[l - 1].nodeType && --l; s = s.childNodes[l]; q = s.splitText(h); q.splitText(m); q.nextSibling && !q.nextSibling.nodeValue && e(q.nextSibling).remove(); q.previousSibling && !q.previousSibling.nodeValue && e(q.previousSibling).remove(); p = e(q).wrap(e().fromHTML(b)[0]); c.push(p)
						} catch (t) { console && console.warn && console.warn("Can't deserialize highlight descriptor. Cause: " + t) }
					}); return c
				}; g.prototype.find =
					function (a, b) { var c = e(this.el).getWindow(), d = c.scrollX, g = c.scrollY, h = "undefined" === typeof b ? !0 : b; e(this.el).removeAllRanges(); if (c.find) for (; c.find(a, h);)this.doHighlight(!0); else if (c.document.body.createTextRange) { var f = c.document.body.createTextRange(); for (f.moveToElementText(this.el); f.findText(a, 1, h ? 4 : 0) && (e(this.el).contains(f.parentElement()) || f.parentElement() === this.el);)f.select(), this.doHighlight(!0), f.collapse(!1) } e(this.el).removeAllRanges(); c.scrollTo(d, g) }; g.createWrapper = function (a) {
						var b =
							document.createElement("span"); b.style.backgroundColor = a.color; b.className = a.highlightedClass; return b
					}; l.TextHighlighter = g
			})(window); (function (l) { function t(l, m) { return function () { m.call(this, l) } } l.fn.getHighlighter = function () { return this.data("textHighlighter") }; l.fn.textHighlighter = function (p) { return this.each(function () { var m = this, h; l.data(m, "textHighlighter") || (h = new TextHighlighter(m, p), h.destroy = t(h.destroy, function (p) { p.call(h); l(m).removeData("textHighlighter") }), l.data(m, "textHighlighter", h)) }) } })(jQuery);

			/******************* End of TextHighlighter *******************/
		</script>

		<!--/******************* Bootstrap *******************/-->
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
			integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
			crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
			integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
			crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
			integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
			crossorigin="anonymous"></script>
		<!--/********************** AOS **********************/-->
		<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
		<script src="https://unpkg.com/aos@next/dist/aos.js"></script>
		<script>
			AOS.init({
			})

		</script>
		<link rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<script type="text/javascript">
			function lengthCheck(confirmation_div_class) {
				var confirmation_div = document.getElementsByClassName(confirmation_div_class);
				for (var i = 0; i < confirmation_div.length; i++) {
					var confirmations = confirmation_div[i].querySelectorAll("[class^=confirmation-]");

					var lengthcheckmsgs = confirmation_div[i].querySelectorAll("[class*=lengthcheckmsg]");
					for (var j = 0; j < lengthcheckmsgs.length; j++) {
						if ($("." + confirmation_div_class + " .lengthcheckmsg" + j).is(":visible")) {
							lengthcheckmsgs[j].animate({ opacity: "0.3" }, { duration: 200 });
							lengthcheckmsgs[j].animate({ opacity: "1.0" }, { duration: 300 });
						}
					}

					var alengthcheckmsgs = confirmation_div[i].querySelectorAll("[class^=alengthcheckmsg]");
					for (var j = 0; j < alengthcheckmsgs.length; j++) {
						if ($("." + confirmation_div_class + " .alengthcheckmsg" + j).is(":visible")) {
							alengthcheckmsgs[j].animate({ opacity: "0.3" }, { duration: 200 });
							alengthcheckmsgs[j].animate({ opacity: "1.0" }, { duration: 300 });
						}
					}

					var annotations = document.querySelectorAll("[id^=Annotation_div_]");
					var num_binary_yes = 0;
					var num_binary_no = 0;
					for (var j = 0; j < annotations.length; j++) {
						var sol = annotations[j].querySelector("[class*=annotation-question]").value.length;
						var anl = annotations[j].querySelector("[class*=annotation-answer]").value.length;
						// query length must more then 10
						if (sol < 10) {
							confirmation_div[i].getElementsByClassName("confirmation-1")[0].checked = false;
							confirmation_div[i].getElementsByClassName("lengthcheckmsg" + (j + 1))[0].innerHTML = "<font color=red><b>FYI:</b> Your question in the annotation <b>" + (j + 1) + "</b> block is pretty short, is it complicated enough?</font>";
							confirmation_div[i].getElementsByClassName("lengthcheckmsg" + (j + 1))[0].style.display = "inline-block";
						}
						else {
							confirmation_div[i].getElementsByClassName("lengthcheckmsg" + (j + 1))[0].style.display = "none";
						}

						// answer length must more than 1
						if (anl < 1) {
							confirmation_div[i].getElementsByClassName("confirmation-1")[0].checked = false;
							confirmation_div[i].getElementsByClassName("alengthcheckmsg" + (j + 1))[0].innerHTML = "<font color=red><b>FYI:</b> Your answer in the annotation <b>" + (j + 1) + "</b> block is pretty short, is it complicated enough?</font>";
							confirmation_div[i].getElementsByClassName("alengthcheckmsg" + (j + 1))[0].style.display = "inline-block";
						} else {
							confirmation_div[i].getElementsByClassName("alengthcheckmsg" + (j + 1))[0].style.display = "none";
						}

						// the total number of yes/no answer should no more than 1
						var lower_case_answer = annotations[j].getElementsByClassName("annotation-answer")[0].value.toLowerCase();
						if (lower_case_answer.substring(0, 3).includes("yes")) {
							num_binary_yes += 1;
						}
						if (lower_case_answer.substring(0, 2).includes("no")) {
							num_binary_no += 1;
						}

						var total = num_binary_no + num_binary_yes;
						if (total > 1) {
							confirmation_div[i].getElementsByClassName("confirmation-1")[0].checked = false;
							confirmation_div[i].getElementsByClassName("binary_yes")[0].innerHTML = "<font color=red><b>FYI:</b> It seems that " + num_binary_yes + " of your annotations are binary with the answer 'yes' or 'no'. Try to convert one of them into non-binary.</font>"
							confirmation_div[i].getElementsByClassName("binary_yes")[0].style.display = "inline-block";
						}
						else {
							confirmation_div[i].getElementsByClassName("binary_yes")[0].style.display = "none";
						}
					}

				}

			}

			function ResetLengthCheck(confirmation_div_class, lengthcheckmsg_class) {
				$("." + confirmation_div_class + " .confirmation-1").prop('checked', false);
				$("." + confirmation_div_class + " ." + lengthcheckmsg_class).hide();
			}

			function ResetAnswerCheck(confirmation_div_class) {
				$("." + confirmation_div_class + " .confirmation-1").prop('checked', false);
				$("." + confirmation_div_class + " .binary_yes").hide();
				$("." + confirmation_div_class + " .binary_no").hide();
			}

			function count_selected_img(Annotation_div_class) {
				var c = 0;

				var anotation_div = document.getElementById(Annotation_div_class);
				var selections = anotation_div.querySelectorAll("[class*=image-selection-]");
				for (var i = 0; i < selections.length; i++) {
					if (selections[i].checked) {
						c += 1;
					}
				}

				return c;
			}

			function provide_fact_check(Annotation_div_class, provide_num = 4) {
				var result = false;
				var anotation_div = document.getElementById(Annotation_div_class);
				var selections = anotation_div.querySelectorAll("[class*=image-selection-]");
				for (var i = 0; i < provide_num; i++) {
					if (selections[i].checked) {
						result = true;
						break;
					}
				}
				return result;
			}

			function find_selected_img(Annotation_div_class) {
				// displaying the text aside
				// get the number of facts:
				var fact_count = document.getElementById("facts_main").getElementsByClassName("col").length;
				var c = Array(fact_count).fill(-10);
				id = 0
				var anotation_div = document.getElementById(Annotation_div_class);
				var selections = anotation_div.querySelectorAll("[class*=image-selection-]");
				for (var i = 0; i < selections.length; i++) {
					if (selections[i].checked) {
						c[id] = i + 1;
						id += 1;
					}
				}
				return c;
			}

			function mul_img_Check(Annotation_div_class, confirmation_div_class) {

				var ischecked = $("." + confirmation_div_class + " .confirmation-3").is(':checked');
				if ($("." + confirmation_div_class + " .count3").is(":visible")) {
					$("." + confirmation_div_class + " .count3").animate({ opacity: "0.3" }, { duration: 200 });
					$("." + confirmation_div_class + " .count3").animate({ opacity: "1.0" }, { duration: 300 });
				}
				var c = count_selected_img(Annotation_div_class);
				var provide_checked = provide_fact_check(Annotation_div_class, 4);
				if (c < 2) {
					$("." + confirmation_div_class + " .confirmation-3").prop('checked', false);
					$("." + confirmation_div_class + " .count3").html("<font color=red><b>FYI:</b> You need to select <b>at least two</b> text snippets in the <b>Text Selection</b> step before checking this checkbox</font>");
					$("." + confirmation_div_class + " .count3").show();
				}
				else if (!provide_checked) {
					$("." + confirmation_div_class + " .confirmation-3").prop('checked', false);
					$("." + confirmation_div_class + " .count3").html("<font color=red><b>FYI:</b> You need to select <b>at least one</b> text snippets provided by us</font>");
					$("." + confirmation_div_class + " .count3").show();
				}
				else {
					$("." + confirmation_div_class + " .count3").hide();
				}


			}

			function ResetConfirmation(confirmation_div_class, Annotation_div_class, idx) {
				console.log("reset!");
				var c = count_selected_img(Annotation_div_class);
				$("." + Annotation_div_class + " .img_selection_limit").hide();
				$("." + confirmation_div_class + " .confirmation-2").prop('checked', false);
				$("." + confirmation_div_class + " .confirmation-3").prop('checked', false);
				$("." + confirmation_div_class + " .count2").hide();
				$("." + confirmation_div_class + " .count3").hide();
				reload_img_thumbnail(Annotation_div_class);
			}

			function reload_img_thumbnail(Annotation_div_class) {
				var c = find_selected_img(Annotation_div_class);
				var annotation_class = document.getElementById(Annotation_div_class);
				var all_HTML = "";
				for (var i = 0; i < c.length; i++) {
					if (c[i] > 0) {
						all_HTML += get_text_snippet(c[i]);
					}
				}
				all_HTML_pre = `
				<table class="text_placeholder" onclick="highlight_update()">
					<tr>
						<th> </td>
						<th> <b>Text Snippet</b> </th>
						<th> <b>Link</b> </th>
					</tr>
				`;
				all_HTML = all_HTML == "" ? all_HTML : all_HTML_pre + all_HTML + "</table>"
				annotation_class.getElementsByClassName("snippets_placeholder")[0].innerHTML = all_HTML;
				console.log("reload thumbnail");
				setuphighlight();
			}

			function copy_span(element) {
				var spanElement = element;
				while (spanElement.className != "highlighted") {
					spanElement = spanElement.nextSibling;
				}
				var copy_text = spanElement.innerText;
				const el = document.createElement('textarea');
				el.value = copy_text;
				document.body.appendChild(el);
				el.select();
				document.execCommand('copy');
				document.body.removeChild(el);

				var all_square = document.getElementsByClassName("fa-square");
				for (var i = 0; i < all_square.length; i++) {
					all_square[i].classList.add("fa-inverse");
				}
				var all_copy = document.getElementsByClassName("fa-copy");
				for (var i = 0; i < all_copy.length; i++) {
					all_copy[i].classList.remove("fa-inverse");
				}
				element.getElementsByClassName("fa-square")[0].classList.remove("fa-inverse");
				element.getElementsByClassName("fa-copy")[0].classList.add("fa-inverse");

			}

			function get_text_snippet(index) {
				var bucket = $("#use_backup").is(':checked') ? "backup" : "main";
				var fact_card_template = `
				<tr>
					<td> {1} </td>
					<td class="textThumbnail" id="thumbnail_{5}" onclick="sync_back_highlight(this)"> {2} </td>
					<td> <a class="text-muted url" href="{3}" target="_blank">{4}</a> </td>
				</tr>
				`;
				var fact_card = document.getElementById(bucket + "_fact_card_" + index);
				var text = fact_card.getElementsByClassName("fact")[0].innerHTML;
				//texttext = $('<div>').text(text).html()
				var url = fact_card.getElementsByClassName("url")[0].href;
				var title = fact_card.getElementsByClassName("url")[0].innerText;
				return replace(fact_card_template, index, text, url, title, fact_card.id);
			}

			function sync_back_highlight(element) {
				var fact_card = document.getElementById(element.id.substring(10));
				fact_card.getElementsByClassName("fact")[0].innerHTML = element.innerHTML;
				update_highlight_placeholder();
			}


			function toggle_set(v) {
				$('#ori_set').toggle();
				$('#backup_set').toggle();
				if (v) { $("#use_backup").prop('checked', !$("#use_backup").is(':checked')); }
				reset_selection_options();

				// reset the selections display
				var all_annotations = document.querySelectorAll('[id^="Annotation_div_"]');
				for (var i = 0; i < all_annotations.length; i++) {
					reload_img_thumbnail(all_annotations[i].id);
				}
			}

			function reset_selection_options() {
				var all_annotations = document.querySelectorAll('[id^="Annotation_div_"]');
				var all_checked = new Array(all_annotations.length);
				for (var i = 0; i < all_annotations.length; i++) {
					var checked = all_annotations[i].querySelectorAll('input[type="checkbox"]:checked');
					var checked_name = new Array(checked.length);
					for (var j = 0; j < checked.length; j++) {
						checked_name[j] = checked[j].name;
					}
					all_checked[i] = checked_name;
				}
				var selection_template = `
				<label class="text-selection">
					<input class="image-selection-{1} image-selection" name="image-selection{1}" onclick="ResetConfirmation('confirmation_div_{2}', 'Annotation_div_{2}', '{1}');" type="checkbox" value="{2}" /> 
					{1} 
				</label> 
				`;
				var using_backup = $("#use_backup").is(':checked');
				var fact_count = using_backup ?
					document.getElementById("facts_backup").getElementsByClassName("col").length :
					document.getElementById("facts_main").getElementsByClassName("col").length;

				var all_selection_placeholder = document.getElementsByClassName("image-select-placeholder");
				for (var i = 0; i < all_selection_placeholder.length; i++) {
					var selections_HTML = "";
					for (var j = 0; j < fact_count; j++) {
						//if (j % 4 == 0) { selections_HTML += "<br>"; }
						selections_HTML += replace(selection_template, j + 1, i + 1);

					}
					all_selection_placeholder[i].innerHTML = selections_HTML;
				}

				for (var i = 0; i < all_annotations.length; i++) {
					var selections = all_annotations[i].getElementsByTagName("input");
					for (var j = 0; j < selections.length; j++) {
						if (all_checked[i].includes(selections[j].name))
							selections[j].checked = true;
					}
				}

			}

			function clean_str(s) {
				return s.replace("_", " ");
			}

			function loading_data() {
				var input = "${base64}";
				var sample_data = "W3siUXR5cGUiOiJ0ZXh0IiwiUXVlc3Rpb24iOiJUaGlzIGlzIGFuIHNhbXBsZSBxdWVzdGlvbiIsIlN1cHBvcnRpbmciOlt7ImZhY3QiOiJUaGUgZnJhY3Rpb24gc2xhc2gg4p+oIOKBhCDin6kgaXMgdXNlZCBiZXR3ZWVuIHR3byBudW1iZXJzIHRvIGluZGljYXRlIGEgZnJhY3Rpb24gb3IgcmF0aW8uIFN1Y2ggZm9ybWF0dGluZyBkZXZlbG9wZWQgYXMgYSB3YXkgdG8gd3JpdGUgdGhlIGhvcml6b250YWwgZnJhY3Rpb24gYmFyIG9uIGEgc2luZ2xlIGxpbmUgb2YgdGV4dC4iLCJ1cmwiOiJodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TbGFzaF8ocHVuY3R1YXRpb24pIiwidGl0bGUiOiJTbGFzaCAocHVuY3R1YXRpb24pIC0gV2lraXBlZGlhIn0seyJmYWN0IjoiSXQgaXMgY2FsbGVkIGEgc29saWR1cyBpbiBVbmljb2RlLCBpdCBpcyBhbHNvIGtub3duIGFzIGFuIG9ibGlxdWUgc3Ryb2tlLCBhbmQgaXQgaGFzIHNldmVyYWwgb3RoZXIgaGlzdG9yaWNhbCBvciB0ZWNobmljYWwgbmFtZXMsIGluY2x1ZGluZyBvYmxpcXVlIGFuZCB2aXJndWxlIC4gQSBzbGFzaCBpbiB0aGUgcmV2ZXJzZSBkaXJlY3Rpb24gXFwgaXMga25vd24gYXMgYSBiYWNrc2xhc2ggLiBTbGFzaGVzIG1heSBiZSBmb3VuZCBpbiBlYXJseSB3cml0aW5nIGFzIGEgdmFyaWFudCBmb3JtIG9mIGRhc2hlcywgdmVydGljYWwgc3Ryb2tlcywgZXRjLiIsInVybCI6Imh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1NsYXNoXyhwdW5jdHVhdGlvbikiLCJ0aXRsZSI6IlNsYXNoIChwdW5jdHVhdGlvbikgLSBXaWtpcGVkaWEifV0sIkd1aWQiOiJmNGUxNTAyYS1lMmYwLTQ5NDItYjQ1MC05NzUyNjY1ZDBhMGIifSx7IlF0eXBlIjoiaW1nLU11bHRpaG9wIiwiUXVlc3Rpb24iOiJcIkRvIFNvdXRoZ2F0ZSBIYWxsIGFuZCBXaWxzb24gSGFsbCBhdCBEdWtlIFVuaXZlcnNpdHkgaGF2ZSB0aGUgc2FtZSBudW1iZXIgb2YgZmxvb3JzP1wiIiwiU3VwcG9ydGluZyI6W3siaWQiOiIwMDAwMDAxNCIsInVybCI6IiIsInRpdGxlIjoiIn0seyJpZCI6IjAwMDAwMDEzIiwidXJsIjoiIiwidGl0bGUiOiIifV0sIkd1aWQiOiIifV0="
				var data;
				try {
					data = JSON.parse(atob(input));
				}
				catch {
					data = JSON.parse(atob(sample_data));
				}


			}

			function replace(str) {
				var args = arguments;
				return str.replace(/{(\d+)}/g, function (match, number) {
					return typeof args[number] != 'undefined'
						? args[number]
						: match
						;
				});
			}


		</script>

		<script type="text/javascript">

			$(window).load(function () {
				var i;
				for (i = 1; i < 13; i++) {
					var s = $("#title-query" + i.toString()).html();
					$("#title-query" + i.toString()).html(clean_str(s));
				}

			});

			$(document).ready(function () {
				alert("Triggered");
				url_elements = document.getElementsByClassName("url");
				for (var i = 0; i < url_elements.length; i++) {
					var url_href = url_elements[i].href;
					url_elements[i].innerHTML = getDomain(url_href);
				}
			});

			function replace(str) {
				var args = arguments;
				return str.replace(/{(\d+)}/g, function (match, number) {
					return typeof args[number] != 'undefined'
						? args[number]
						: match
						;
				});
			}

			function deleteNewFact(bucket, num) {
				var fact_card = document.getElementsByName("card_" + bucket + "_new_fact_" + num)[0];
				var fact_input = document.getElementsByName(bucket + "_new_fact_" + num)[0];
				var url_input = document.getElementsByName(bucket + "_new_url_" + num)[0];
				fact_card.remove();
				fact_input.remove();
				url_input.remove();
				reset_selection_options();
			}

			function insertNewFact() {
				var fact_template = `
				<!-- Text Snippet {1}-->
				<div class="col" style="min-width:23%" name="card_{7}">
					<div class="card mb-3" style="max-width: 30rem;"  id="{6}_fact_card_{1}">

						<div class="card-header bg-transparent" style="padding-left:0;padding-right:0;">
							<div class="container" style="padding:0;">
								<div style="text-align:center;position:relative;">
									<span class="fa-stack copy" onclick="copy_fact(this)"
										style="font-size:15px;" data-toggle="tooltip"
										title="Copy the whole fact">
										<i class="fa fa-square fa-stack-2x fa-inverse"></i>
										<i class="fa fa-copy fa-stack-1x"></i>
									</span>
									<span >Text Snippet {1}:</span>
									<button class="btn" style="position:absolute;right:0;top: 50%; transform: translateY(-50%);" type="button"  onclick="deleteNewFact('{6}', {1})">
										<span>x</span>
									</button>
								</div>
							</div>
						</div>
						<div class="card-body">
							<p class="card-text fact" id="text{4}">{2}</p>
						</div>
						<div class="card-footer">
							<a class="text-muted url" href="{3}" id="url{4}" target="_blank">{5}</a>
						</div>
					</div>
				</div>

				`;

				var input_hide_template = `
					<crowd-input name="{1}" required value="{2}" style="display:none;"></crowd-input>
				`;


				var new_fact = document.getElementById("newFact").value;
				new_fact = $('<div>').text(new_fact).html();
				new_fact = new_fact.replace(/\"/gi, '%22');
				var new_url = document.getElementById("newUrl").value;

				if (new_fact.trim().length <= 40 || new_fact.split(" ").length <= 20) {
					alert("The fact is not complicated enough, please paste text with at least 20 words!");
					return;
				}
				if (new_fact.trim().length > 700) {
					alert("The fact is too long, please make sure it has less than 700 characters!");
					return;
				}

				if (new_url.trim().length <= 10) {
					alert("The URL is not valid, please paste the new fact into the URL textbox!");
					return;
				}

				var domain = getDomain(new_url);
				if (domain.trim().length == 0) {
					alert("The URL is invalid, please double check.");
					return;
				}

				if (domain == "www.bing.com" || domain == "www.google.com") {
					alert("Please do not paste things from search engine.");
					return;
				}

				var using_backup = $("#use_backup").is(':checked');
				// get the fact count based on the bucket
				var fact_count = using_backup ?
					document.getElementById("facts_backup").getElementsByClassName("col").length :
					document.getElementById("facts_main").getElementsByClassName("col").length;

				// insert the fact into the bucket
				if (using_backup) {
					document.getElementById("facts_backup").innerHTML += replace(fact_template, fact_count + 1, new_fact, new_url, (fact_count) * 2 + 1, domain, "backup", "backup_new_fact_" + (fact_count + 1));
					document.getElementById("facts_backup").innerHTML = document.getElementById("facts_backup").innerHTML.replace("title data-bs-original-title=", "title=");
				}
				else {
					document.getElementById("facts_main").innerHTML += replace(fact_template, fact_count + 1, new_fact, new_url, fact_count + 1, domain, "main", "main_new_fact_" + (fact_count + 1));
					var facts_backup = document.getElementById("facts_backup");
					var urls_div = facts_backup.getElementsByClassName("url");
					for (var i = 0; i < urls_div.length; i++) {
						// fact_count +1 = the number of facts in main section
						// i+ = index off set
						var index = fact_count + i + 2;
						urls_div[i].id = "url" + index;
					}

					var facts_div = facts_backup.getElementsByClassName("fact");
					for (var i = 0; i < facts_div.length; i++) {
						var index = fact_count + i + 2;
						facts_div[i].id = "text" + index;
					}
				}

				// adding to selection 
				reset_selection_options()

				// adding to submission
				var submit_prefix = using_backup ? "backup" : "main";
				var new_fact_input = replace(input_hide_template, submit_prefix + "_new_fact_" + (fact_count + 1), new_fact);
				var new_url_input = replace(input_hide_template, submit_prefix + "_new_url_" + (fact_count + 1), new_url);
				var hide_div = document.getElementById("submission_hide_placeholder");
				hide_div.innerHTML += new_fact_input;
				hide_div.innerHTML += new_url_input;


				// reset the insert area:
				document.getElementById("newFact").value = null;
				document.getElementById("newUrl").value = null;
				document.getElementById("newFactCollapse").classList.remove("show");

				var all_annotations = document.querySelectorAll('[id^="Annotation_div_"]')
				for (var i = 0; i < all_annotations.length; i++) {
					reload_img_thumbnail(all_annotations[i].id);
				}

				setuphighlight();
				fix_tooltip();
			}

			function getDomain(url) {
				var domain
				try {
					domain = (new URL(url));
				}
				catch (e) {
					alert("The url is not valid. Please check your input!");
				}
				return domain.hostname;
			}

			function fix_tooltip() {
				var copy_buttons = document.getElementsByClassName("copy");
				for (var i = 0; i < copy_buttons.length; i++) {
					var title = copy_buttons[i].title ||
						copy_buttons[i].dataset.originalTitle ||
						copy_buttons[i].dataset.bsOriginalTitle;
					copy_buttons[i].title = title;
					copy_buttons[i].dataset.originalTitle = title;
					copy_buttons[i].dataset.bsOriginalTitle = title;
				}
				$('[data-toggle="tooltip"]').tooltip();
			}

			function mergeNeighborHighlights(nonword) {
				var childNodes = $(".highlighted")[0].parentNode.childNodes;
				var i = 0;
				while (i < childNodes.length - 2) {
					if (childNodes[i].className !== "highlighted") {
						i++;
						continue;
					}
					var re = new RegExp(nonword, 'g');
					var match = re.exec(childNodes[i + 1].textContent);
					if (match && match.index == 0 && match[0].length == childNodes[i + 1].textContent.length) {
						// Merge
						childNodes[i].textContent += childNodes[i + 1].textContent + childNodes[i + 2].textContent;
						childNodes[i + 1].parentNode.removeChild(childNodes[i + 1]);
						childNodes[i + 1].parentNode.removeChild(childNodes[i + 1]);
						// childNodes[i+1].remove();
						continue;
					}
					else {
						i++;
					}
				}
			}

			function check_nav() {

				var all_nav = document.querySelectorAll("[id^=id-navbar-]");
				for (var i = 0; i < all_nav.length; i++) {
					var collap = document.querySelector("[class^=" + all_nav[i].id + "]");
					if (collap == null) { continue; }
					if (all_nav[i].classList.contains("active")) {
						collap.classList.add("show");
					}
					else {
						collap.classList.remove("show");
					}
				}

			}

			function remove_copybutton(element) {
				if (element.previousElementSibling == null) {
					return;
				}
				while (element.previousSibling != element.previousElementSibling) {
					if (element.previousSibling.nodeName == "#text" && element.previousSibling.textContent.trim() == "") {
						element.previousSibling.remove();
					}
					else {
						element = element.previousSibling;
					}
				}
				if (element.previousElementSibling.classList.contains("copy")) {
					element.previousElementSibling.remove();
				}
			}

			function setuphighlight() {
				var nonword = /[ |-]+|[,\.]+(?!\d) */;
				nonword = nonword.source;
				var prompt = document.getElementById("promot");
				//var texts = prompt.getElementsByClassName("fact");
				var allitems = [];
				allitems = Array.prototype.concat.apply(allitems, prompt.getElementsByClassName("fact"));
				allitems = Array.prototype.concat.apply(allitems, document.getElementsByClassName("textThumbnail"));

				//var thumbnails = document.getElementsByClassName("textThumbnail");
				//texts = texts.concat(thumbnails);
				for (var m = 0; m < allitems.length; m++) {
					var hltr = new TextHighlighter(allitems[m],
						{
							onAfterHighlight: function (range) {
								var new_range = range.commonAncestorContainer;
								while (new_range.tagName == "SPAN") {
									new_range = new_range.parentNode;
								}
								var highlighted_elements = new_range.getElementsByClassName("highlighted");

								if (highlighted_elements.length == 0) {
									// Still no highlight after highlights
									return;
								}

								for (var i = 0; i < highlighted_elements.length; i++) {
									highlighted_elements[i].addEventListener("click", function (event) {
										console.log("calling from after click highlight");
										remove_copybutton(event.currentTarget);
										hltr.removeHighlights(event.currentTarget);
									});
								}

								var highlighted = new_range.getElementsByClassName("highlighted");
								for (var j = 0; j < highlighted.length; j++) {
									childNodes = highlighted[j].parentNode.childNodes;

									var re = null;
									var firstMatch = null;
									var lastMatch = null;
									var res = null;
									for (var i = 0; i < childNodes.length; ++i) {
										if (childNodes[i] && childNodes[i].className === "highlighted") {
											if (i > 0) {  // text segment on the left
												// 1. highlighted starts with a word boundary
												//    push the boundary to text on the left
												//console.log("left");
												firstMatch = null;
												lastMatch = null;
												re = new RegExp(nonword, 'g');
												firstMatch = re.exec(childNodes[i].textContent);
												if (firstMatch && firstMatch.index == 0) {
													childNodes[i - 1].textContent += firstMatch[0];
													childNodes[i].textContent = childNodes[i].textContent.slice(firstMatch[0].length);
												}
												else {
													// 2. if previous text does not end with a word boundary
													//    push the last partial word to highlighted phrase
													re = new RegExp(nonword, 'g');
													while ((res = re.exec(childNodes[i - 1].textContent)) != null) { lastMatch = res; }
													if (lastMatch && lastMatch.index + lastMatch[0].length !== childNodes[i - 1].textContent.length) {
														childNodes[i].textContent =
															childNodes[i - 1].textContent.slice(lastMatch.index + lastMatch[0].length) + childNodes[i].textContent;
														childNodes[i - 1].textContent = childNodes[i - 1].textContent.slice(0, lastMatch.index + lastMatch[0].length);
													}
													else if (lastMatch === null && i == 1) {  // boundary case, leftmost text contains no word boundaries but needs to be merged.
														childNodes[i].textContent = childNodes[i - 1].textContent + childNodes[i].textContent;
														childNodes[i - 1].textContent = "";
													}
												}
											}
											// Fix right end
											if (i < childNodes.length) {  // text segment on the right
												// 1. highlighted ends with a word boundary
												//    push the boundary to text on the right
												//console.log("right");
												firstMatch = null;
												lastMatch = null;
												re = new RegExp(nonword, 'g');
												while ((res = re.exec(childNodes[i].textContent)) !== null) { lastMatch = res; }
												if (lastMatch && lastMatch.index + lastMatch[0].length === childNodes[i].textContent.length) {
													if (i == childNodes.length - 1) {  // highlight at the end of text. Push nonwords outside highlights if any
														var textNode = document.createTextNode(lastMatch[0]);         // Create a text node
														childNodes[i].parentNode.appendChild(textNode);
													}
													else {
														childNodes[i + 1].textContent = lastMatch[0] + childNodes[i + 1].textContent;
													}
													childNodes[i].textContent = childNodes[i].textContent.slice(0, lastMatch.index);
												}
												else {
													// 2. if next text does not begin with a word boundary
													//    push the first partial word in the next text to highlighted phrase
													if (i == childNodes.length - 1) {  // highlight at the end of text. No next text so break.
														break;
													}
													re = new RegExp(nonword, 'g');
													firstMatch = re.exec(childNodes[i + 1].textContent);
													if (firstMatch && firstMatch.index != 0) {
														childNodes[i].textContent += childNodes[i + 1].textContent.slice(0, firstMatch.index);
														childNodes[i + 1].textContent = childNodes[i + 1].textContent.slice(firstMatch.index);
													}
													else if (firstMatch === null && i == childNodes.length - 2) {
														childNodes[i].textContent += childNodes[i + 1].textContent;
														childNodes[i + 1].textContent = "";
													}
												}
											}
										}
									}
								}


								// Modify highlight boundaries

								// Merge adjacent highlight areas if only separated by "non-word"
								mergeNeighborHighlights(nonword);

								var highlighted = new_range.getElementsByClassName("highlighted");

								for (var j = 0; j < highlighted.length; j++) {
									console.log("calling from resetting");
									remove_copybutton(highlighted[j]);
								}

								console.log("remove done");
								try {
									add_copybutton(new_range);
								}
								catch (e) {
									console.log(e);
								}

							},
							// Do nothing before highlighting
							onBeforeHighlight: function (range) {
								return true;

							},

							// Do nothing before removing highlights
							onRemoveHighlight: function (hlt) {
								return true;
							}
						}
					);

					var span_element = hltr.el.getElementsByClassName("highlighted");
					//console.log(span_element);
					for (var i = 0; i < span_element.length; i++) {
						span_element[i].addEventListener("click", function (event) {
							console.log("removing highlited and copy button");
							console.log("calling from after setup highlight");
							remove_copybutton(event.currentTarget);

							hltr.removeHighlights(event.currentTarget);

						})
					}
				}

			}


			function highlight_update() {

				var all_annotations = document.querySelectorAll('[id^="Annotation_div_"]')
				for (var i = 0; i < all_annotations.length; i++) {
					reload_img_thumbnail(all_annotations[i].id);
				}
				update_highlight_placeholder();
				fix_tooltip();

			}

			function add_copybutton(element) {
				var highlighted = element.getElementsByClassName("highlighted");
				var copy_template = `<span class="fa-stack copy" onclick="copy_span(this)" name="{1}" style="font-size:10px;" data-toggle="tooltip" title="Copy this highlighed text">
  					<i class="fa fa-square fa-stack-2x fa-inverse"></i>
  					<i class="fa fa-copy fa-stack-1x"></i>
				</span>`
				for (var i = 0; i < highlighted.length; i++) {
					var copy_buttons = element.getElementsByClassName('copy');
					var copy_button = [];
					for (var i = 0; i < copy_buttons.length; i++) {
						if (copy_buttons[i].name == highlighted[i].dataset.timestamp) {
							copy_button.add(copy_buttons[i]);
						}
					}
					if (copy_button.length == 0) {
						highlighted[i].outerHTML = replace(copy_template, highlighted[i].dataset.timestamp) + highlighted[i].outerHTML;
					}

				}
			}

			function update_highlight_placeholder() {
				var input_hide_template = `
					<crowd-input name="{1}" required value="{2}" style="display:none;"></crowd-input>
				`;
				var all_highlights = document.querySelectorAll('[id*=_fact_card_]')
				var all_highlights_HTML = "";
				for (var i = 0; i < all_highlights.length; i++) {
					if (all_highlights[i].id.startsWith("main") || all_highlights[i].id.startsWith("backup")) {
						var name = all_highlights[i].id;
						var value = all_highlights[i].getElementsByClassName("fact")[0].innerHTML;
						value = $('<div>').text(value).html();
						value = value.replace(/\"/gi, '%22');
						all_highlights_HTML += replace(input_hide_template, name, value);
					}
				}
				document.getElementById("highlight_hide_placeholder").innerHTML = all_highlights_HTML;
			}

			function check_session() {
				var count = sessionStorage.getItem("number_hits");
				count = count == null ? 0 : parseInt(count);
				console.log(count);
				if (count < 3) {
					$('#InstructionModel').modal('show');
				}
				sessionStorage.setItem("number_hits", count + 1);
			}

			function copy_fact(element) {
				try {
					var cardElement = element;
					while (!cardElement.classList.contains("card")) {
						cardElement = cardElement.parentElement;
					}
					var textElement = cardElement.getElementsByClassName("fact")[0];
					var copy_text = textElement.innerText;
					const el = document.createElement('textarea');
					el.value = copy_text;
					document.body.appendChild(el);
					el.select();
					document.execCommand('copy');
					document.body.removeChild(el);

					var all_square = document.getElementsByClassName("fa-square");
					for (var i = 0; i < all_square.length; i++) {
						all_square[i].classList.add("fa-inverse");
					}
					var all_copy = document.getElementsByClassName("fa-copy");
					for (var i = 0; i < all_copy.length; i++) {
						all_copy[i].classList.remove("fa-inverse");
					}
					element.getElementsByClassName("fa-square")[0].classList.remove("fa-inverse");
					element.getElementsByClassName("fa-copy")[0].classList.add("fa-inverse");
				}
				catch (error) {
					throw error;
				}
			}
		</script>

	</section>

	<div class="container-fluid" style="height:100vh">
		<h1 style="margin:5px;height:5vh;white-space: nowrap;">Writing textual queries whose answer can be derived from
			multiple distinct facts</h1>
		<div class="row" style="height:100%">
			<div class="col-2" style="padding:10px;">
				<!-- Modal onmouseover="highlight();" -->
				<!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#Instruction">
					Instruction
				</button>

				
				 -->
				<nav id="navbar" class="avbar navbar-light bg-light">
					<a class="navbar-brand" href="#"></a>
					<nav class="nav nav-pills flex-column" style="padding:10px;">
						<a class="nav-link btn btn-outline-secondary" data-toggle="modal"
							data-target="#InstructionModel" id="id-navbar-instruction"
							style="margin:10px;">Instructions</a>
						<div class="modal fade" id="InstructionModel" tabindex="-1" role="dialog"
							aria-labelledby="exampleModalCenterTitle" aria-hidden="true" height="1200">
							<div class="modal-dialog modal-xl" height="100%">
								<div class="modal-content" style="height:90%;">
									<div class="modal-header">
										<h5 class="modal-title" id="exampleModalLongTitle">Instructions</h5>
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body" height="100%">

										<iframe frameborder="0" height="100%" width="100%"
											src="https://quantusproject.github.io/mutli_reasoning_facts_instructions.html"></iframe>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary"
											data-dismiss="modal">Close</button>

									</div>
								</div>
							</div>
						</div>
						<a class="nav-link active" href="#Facts" id="id-navbar-facts">Facts</a>
						<div class="id-navbar-facts collapse show" id="navbar-collapse-facts">
							<div style="font-size:13px;padding:15px;margin:10px;">
								<h5>Highlight facts</h5>
								<p>For your convenience you can use the highlighting feature we provide to highlight
									part of text/keywords in given facts:</p>
								<ol>
									<li><b style="color:green">Highlight a fact:</b> select the text you want to
										highlight;</lili>
									<li><b style="color:red">Remove highlight:</b> click on the highlighted
										text.</li>
									<li><b style="color:darkgoldenrod">Copy highlight:</b><span>You can copy the text
											you highlighed by click on the <span class="fa fa-copy"></span> before
											it.</span></li>
								</ol>

								<h5>Insert new fact</h5>
								<p>Feel free to add new fact if the given facts are not enough to format new question
									and answer. Follow the following instruction</p>
								<ol>
									<li>The new fact should be somehow <b>related to the given one</b>;</li>
									<li>The new fact should be <b>complicated enough</b>, and the <b>surrending text</b>
										should also
										be included.</li>
									<li>All new fact should be <b>extract from webpage</b>, please also provide the URL
										to the
										webpage in the given field.</li>
									<li>Plase <b>DO NOT</b> make up any fact by yourself.</li>
								</ol>
							</div>
						</div>
						<a class="nav-link" href="#Annotations" id="id-navbar-annotations">Annotations</a>
						<div class="id-navbar-annotations collapse" id="navbar-collapse-annotation">
							<div style="font-size:13px;padding:15px;margin:10px;">
								<h5>A valid annotation should include:</h5>
								<ol>
									<li>Select <b style="color:red">two or more text snippets</b> fom the given group
										. This should include any new facts that you may have added.</li>
									<li>For your convenience you can use the highlighting feature we provide to
										highlight part of text/keywords in given facts. These should help you to
										organize, capture and refer back main thoughts while formulating a multi-hop
										reasoning question. </li>
									<li>Ask a question about the <b style="color:red">text snippets you select</b>. To
										get the answer to question must <b style="color:green">need distinct info from
											multiple facts</b>.</li>
									<li>Write down the <b style="color:red">correct answer of your query</b>. The answer
										should be <b>concluded
											from ALL</b> text snippets you selected.</li>

								</ol>
							</div>
						</div>
					</nav>
				</nav>

			</div>
			<div class="col-10" data-spy="scroll" data-target="#navbar" data-offset="10" tabindex="0"
				style="overflow-y: scroll; height:93vh; padding:10; width:100%;" onscroll="setTimeout(check_nav,100);"
				onmove="console.log('on move')">

				<!-- ================================================== Announce Section =============================================================-->
				<section class="row" id="Facts">
					<iframe frameborder="0" style="width:100%;height:150;"
						src="https://quantusproject.github.io/multi-reasoning-announce.html"></iframe>
				</section>
				<section class="row">
					<!-- ================================================== Annotation  Section ============================================================== -->
					<div class="col-12"><br />
						<div id="Annotations">
							<div style="margin-top:30px; margin-bottom:10px;">
								<font size="4"><b>Steps</b></font>
							</div>

							<ol>
								<li><b>
										<font color="green">Text Selection</font>
									</b>: Index of the text(s) you choose</li>
								<li><b>
										<font color="blue">Question</font>
									</b>: Your question</li>
								<li><b>
										<font color="red">Answer</font>
									</b>: Your answer to the question. Keep it short.</li>
							</ol>
							<!-- ....................................... Annotation 1  ............................................... -->

							<div style="margin-top:50px; margin-bottom:10px;">
								<font size="4"><b>Annotation 1</b></font>
							</div>

							<table class="table table-light table-responsive px-0 Annotation_div_1"
								id="Annotation_div_1">
								<tbody>
									<tr class="annotation_table">
										<td width="10%"><b>
												<font color="green">Text Selection</font>
											</b></td>
										<td style="text-align: center;" width="16%" class="image-select-placeholder">
											<label class="text-selection"><input
													class="image-selection-1 image-selection-div-1"
													name="image-selection1"
													onclick="ResetConfirmation('confirmation_div_1', 'Annotation_div_1', '1');"
													type="checkbox" value="1" /> 1 </label>
											<label class="text-selection"><input
													class="image-selection-2  image-selection-div-1"
													name="image-selection2"
													onclick="ResetConfirmation('confirmation_div_1', 'Annotation_div_1', '2');"
													type="checkbox" value="1" /> 2 </label>
											<label class="text-selection"><input
													class="image-selection-3  image-selection-div-1"
													name="image-selection3"
													onclick="ResetConfirmation('confirmation_div_1', 'Annotation_div_1', '3');"
													type="checkbox" value="1" /> 3 </label>
											<label class="text-selection"><input
													class="image-selection-4  image-selection-div-1"
													name="image-selection4"
													onclick="ResetConfirmation('confirmation_div_1', 'Annotation_div_1', '4');"
													type="checkbox" value="1" /> 4 </label>
										</td>
										<td width="20%">
											<div class="img_selection_limit" style="display:none;"><span
													style="color:red">Please select at least 2 text snippets.</span>
											</div>
										</td>
										<td rowspan="7" width="100%">
											<div class="card-group snippets_placeholder">

											</div>

										</td>
									</tr>
									<tr>
										<td><b>
												<font color="blue">Question</font>
											</b></td>
										<td colspan="2" width="40%"><textarea class="form-control annotation-question"
												id="annotation-question" name="annotation-question.1"
												onclick="ResetLengthCheck('confirmation', 'lengthcheckmsg1');"
												required="" rows="4" type="text" value="1"></textarea></td>
									</tr>
									<tr>
										<td><b>
												<font color="red">Answer:</font>
											</b></td>
										<td colspan="2" width="40%"><textarea class="form-control annotation-answer"
												id="annotation-answer" name="annotation-answer.1"
												onclick="ResetAnswerCheck('confirmation');" required="" rows="2"
												type="text" value="1"></textarea></td>
									</tr>
								</tbody>
							</table>

							<div class="alert alert-warning alert-dismissable" role="alert"><b>Search Engine</b>: Is
								the
								answer already found by current search engines?</div>

							<div class="alert alert-warning alert-dismissable" role="alert">
								<strong>Multi-hop</strong>:
								We
								are paticularly interested in questions that requires reasoning over two different
								text snippets.
							</div>

							<div class="col-12 confirmation_div_1" id="confirmation_div_1" style="margin-bottom:50px;">
								<br />
								<label><input class="confirmation-3" name="mul_img_confirmation"
										onclick="mul_img_Check('Annotation_div_1', 'confirmation_div_1');"
										type="checkbox" required="true" value="1" /> My question requires
									information
									pieces coming from at
									least two
									different
									text snippets </label>

								<div class="count2" style="display:none;">&nbsp;</div>

								<div class="count3" style="display:none;">&nbsp;</div>
							</div>
							<!-- ....................................... Annotation 2  ............................................... -->
							<!-- TODO -->
							<div style="margin-bottom:10px;">
								<font size="4"><b>Annotation 2</b></font>
							</div>

							<table class="table table-light table-responsive px-0 Annotation_div_2"
								id="Annotation_div_2">
								<tbody>
									<tr class="annotation_table">
										<td width="10%"><b>
												<font color="green">Text Selection</font>
											</b></td>
										<td style="text-align: center; " class="image-select-placeholder" width="16%">
											<label class="text-selection"><input
													class="image-selection-1  image-selection-div-2"
													name="image-selection1"
													onclick="ResetConfirmation('confirmation_div_2', 'Annotation_div_2', '1');"
													type="checkbox" value="2" /> 1 </label>
											<label class="text-selection"><input
													class="image-selection-2  image-selection-div-2"
													name="image-selection2"
													onclick="ResetConfirmation('confirmation_div_2', 'Annotation_div_2', '2');"
													type="checkbox" value="2" /> 2 </label>
											<label class="text-selection"><input
													class="image-selection-3  image-selection-div-2"
													name="image-selection3"
													onclick="ResetConfirmation('confirmation_div_2', 'Annotation_div_2', '3');"
													type="checkbox" value="2" /> 3 </label>
											<label class="text-selection"><input
													class="image-selection-4  image-selection-div-2"
													name="image-selection4"
													onclick="ResetConfirmation('confirmation_div_2', 'Annotation_div_2', '4');"
													type="checkbox" value="2" /> 4 </label>
										</td>
										<td width="20%">
											<div class="img_selection_limit" style="display:none;"><span
													style="color:red">Please select at least 2 text snippets.</span>
											</div>
										</td>
										<td rowspan="7" width="70%">
											<div class="card-group snippets_placeholder">

											</div>

										</td>
									</tr>
									<tr>
										<td><b>
												<font color="blue">Question</font>
											</b></td>
										<td colspan="2" width="40%"><textarea class="form-control annotation-question"
												id="annotation-question" name="annotation-question.2"
												onclick="ResetLengthCheck('confirmation', 'lengthcheckmsg2');"
												required="" rows="4" type="text" value="2"></textarea></td>
									</tr>
									<tr>
										<td><b>
												<font color="red">Answer:</font>
											</b></td>
										<td colspan="2" width="40%"><textarea class="form-control annotation-answer"
												id="annotation-answer" name="annotation-answer.2"
												onclick="ResetAnswerCheck('confirmation');" required="" rows="2"
												type="text" value="2"></textarea></td>
									</tr>
								</tbody>
							</table>

							<div class="alert alert-warning alert-dismissable" role="alert"><b>Search Engine</b>: Is
								the
								answer already found by current search engines?</div>

							<div class="alert alert-warning alert-dismissable" role="alert">
								<strong>Multi-hop</strong>:
								We
								are paticularly interested in questions that requires reasoning over two different
								text snippets.
							</div>

							<div class="col-12 confirmation_div_2" id="confirmation_div_2" style="margin-bottom:50px;">
								<br />
								<label><input class="confirmation-3" name="mul_img_confirmation"
										onclick="mul_img_Check('Annotation_div_2', 'confirmation_div_2');"
										type="checkbox" required="true" value="2" /> My question requires
									information
									pieces coming from at
									least two
									different
									text snippets </label>

								<div class="count2" style="display:none;">&nbsp;</div>

								<div class="count3" style="display:none;">&nbsp;</div>
							</div>

							<div class="form-group" style="margin-top: 10px;"><label for="feedback">Optional
									Feedback:</label><textarea class="form-control" id="feedback" name="feedback"
									rows="2" type="text">                      </textarea></div>
						</div>
					</div>
				</section>
				<!-- ============================================== Confirmation Section ======================================================= -->

				<section class="confirmation" id="confirmation" style="margin-bottom: 60px;">
					<div style="width: 100%;"><br />
						<label><input class="confirmation-1" name="length_confirmation"
								onclick="lengthCheck('confirmation');" required="" type="checkbox" /> My questions
							aren't answered by Bing/Google's text search </label>
					</div>
					<br>

					<div class="lengthcheckmsg1" style="display:none;width: 100%;">&nbsp;</div>

					<div class="lengthcheckmsg2" style="display:none;width: 100%;">&nbsp;</div>

					<div class="alengthcheckmsg1" style="display:none;width: 100%;">&nbsp;</div>

					<div class="alengthcheckmsg2" style="display:none;width: 100%;">&nbsp;</div>


					<div class="binary_yes" style="display:none;width: 100%;">&nbsp;</div>

					<div class="binary_no" style="display:none;width: 100%;">&nbsp;</div>

					<div style="margin: 20px auto; text-align: center;"><input class="btn btn-primary" id="submitButton"
							type="submit" value="Submit" /></div>
					<div id="submission_hide_placeholder">

					</div>
					<div id="highlight_hide_placeholder">

					</div>
				</section>
				<!-- End input from Worker -->
			</div>
			<div class="col-2" </div>
			</div>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"
		integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js"
		integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc"
		crossorigin="anonymous"></script>
	<style type="text/css">
		#submitButton {
			white-space: normal;
		}

		.image {
			margin-bottom: 15px;
		}

		ul.bad_examples_instruction {
			list-style: none;
		}

		ul.bad_examples_instruction li {
			color: red;
		}

		ul.bad_examples_instruction span {
			color: black;
		}

		img:hover:not(.thumbnail) {
			position: relative;
			transform: scale(2);
			display: inline-block;
			z-index: 999;
			cursor: pointer;
			-webkit-transition-property: all;
			-webkiy-transition-duration: 0.3s;
			-webkit-transition-timing-function: ease;
		}

		td {
			overflow: hidden;
		}

		.card-text {
			text-align: left;
		}

		table.text_placeholder,
		table.text_placeholder th,
		table.text_placeholder td {
			margin: 2px;
			border: 1px solid black;
			border-collapse: collapse;
		}

		* {
			box-sizing: border-box;
		}

		.item {
			width: 200px;
			height: 200px;
			margin: 50px auto;
			padding-top: 75px;
			background: #ccc;
			text-align: center;
			color: #FFF;
			font-size: 3em;
		}

		*:focus {
			outline: none;
		}

		label.text-selection {
			margin-left: 5;
			margin-right: 5;
		}

		i.copy-button {
			border: 1px solid black;
			-moz-border-radius: 50%;
			-webkit-border-radius: 50%;
			height: 17px;
			width: 17px;
			border-radius: 50%;
			text-align: center;
			vertical-align: baseline;
			background-color: white;
			font-size: 11px;

		}
	</style>
	<script type="text/javascript">
		setuphighlight();
		check_session();
		$('[data-toggle="tooltip"]').tooltip();
	</script>
</crowd-form>