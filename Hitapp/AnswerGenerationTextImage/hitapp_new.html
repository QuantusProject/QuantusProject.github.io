<!-- You must include this JavaScript file -->
<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<!-- For the full list of available Crowd HTML Elements and their input/output documentation,
      please refer to https://docs.aws.amazon.com/sagemaker/latest/dg/sms-ui-template-reference.html -->
<!-- You must include crowd-form so that your task submits answers to MTurk -->
<crowd-form answer-format="flatten-objects" style="height:100%">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
		integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<section class="container">
		<script type='text/javascript' src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'>
		</script>
		<!--/******************* Bootstrap *******************/-->
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
			integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
			crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
			integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
			crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
			integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
			crossorigin="anonymous"></script>
		<link rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<script type="text/javascript">
			function loading_data() {
				var input = "${base64}";
				var sample_data = "W3siUXR5cGUiOiAiaW1nLU11bHRpaG9wIiwgIlF1ZXN0aW9uIjogIlwiQXJlIHRoZSBzb2ZhcyBpbiB0aGUgIFRoZSBWaWxsYSBMYSBQYXVzYSBsaWJyYXJ5IHJlcGxpY2EgYXQgdGhlIERhbGxhcyBNdXNldW0gb2YgQXJ0IGFuZCB0aGUgU3BlYWtlciBvZiB0aGUgSG91c2Ugb2YgUmVwcmVzZW50YXRpdmVzIG9mZmljZSByZXBsaWNhIGluc2lkZSB0aGUgU2FtIFJheWJ1cm4gTGlicmFyeSBhbmQgTXVzZXVtIHRoZSBzYW1lIGNvbG9yP1wiIiwgIlN1cHBvcnRpbmciOiBbeyJpZCI6ICIwMDAxMjk2MyIsICJ1cmwiOiAiaHR0cHM6Ly91cGxvYWQud2lraW1lZGlhLm9yZy93aWtpcGVkaWEvY29tbW9ucy90aHVtYi83LzdkL0RhbGxhc19NdXNldW1fb2ZfQXJ0X0p1bHlfMjAxNV8wNV8lMjhWaWxsYV9MYV9QYXVzYV9saWJyYXJ5X3JlcGxpY2ElMjkuanBnLzgwMHB4LURhbGxhc19NdXNldW1fb2ZfQXJ0X0p1bHlfMjAxNV8wNV8lMjhWaWxsYV9MYV9QYXVzYV9saWJyYXJ5X3JlcGxpY2ElMjkuanBnIiwgInBhZ2UiOiAiaHR0cHM6Ly9jb21tb25zLndpa2ltZWRpYS5vcmcvd2lraS9GaWxlOkRhbGxhc19NdXNldW1fb2ZfQXJ0X0p1bHlfMjAxNV8wNV8lMjhWaWxsYV9MYV9QYXVzYV9saWJyYXJ5X3JlcGxpY2ElMjkuanBnIiwgInRpdGxlIjogIkRhbGxhcyBNdXNldW0gb2YgQXJ0IEp1bHkgMjAxNSAwNSAoVmlsbGEgTGEgUGF1c2EgbGlicmFyeSByZXBsIn0sIHsiaWQiOiAiMDAwMTI5NjQiLCAidXJsIjogImh0dHBzOi8vdXBsb2FkLndpa2ltZWRpYS5vcmcvd2lraXBlZGlhL2NvbW1vbnMvdGh1bWIvOC84YS9TYW1fUmF5YnVybl9MaWJyYXJ5X2FuZF9NdXNldW1fSnVuZV8yMDE3XzRfJTI4U3BlYWtlcl9vZl90aGVfSG91c2Vfb2ZfUmVwcmVzZW50YXRpdmVzX29mZmljZV9yZXBsaWNhJTI5LmpwZy84MDBweC1TYW1fUmF5YnVybl9MaWJyYXJ5X2FuZF9NdXNldW1fSnVuZV8yMDE3XzRfJTI4U3BlYWtlcl9vZl90aGVfSG91c2Vfb2ZfUmVwcmVzZW50YXRpdmVzX29mZmljZV9yZXBsaWNhJTI5LmpwZyIsICJwYWdlIjogImh0dHBzOi8vY29tbW9ucy53aWtpbWVkaWEub3JnL3dpa2kvRmlsZTpTYW1fUmF5YnVybl9MaWJyYXJ5X2FuZF9NdXNldW1fSnVuZV8yMDE3XzRfJTI4U3BlYWtlcl9vZl90aGVfSG91c2Vfb2ZfUmVwcmVzZW50YXRpdmVzX29mZmljZV9yZXBsaWNhJTI5LmpwZyIsICJ0aXRsZSI6ICJTYW0gUmF5YnVybiBMaWJyYXJ5IGFuZCBNdXNldW0gSnVuZSAyMDE3IDQgKFNwZWFrZXIgb2YgdGhlIEhvdXNlIG9mIFJlcHJlc2VudGF0aXZlcyBvZmZpY2UgcmVwbCJ9XX0sIHsiUXR5cGUiOiAiaW1nLVNpbmdsZWhvcCIsICJRdWVzdGlvbiI6ICJcIkRvZXMgYWxsIG9mIHRoZSBFbXBpcmUgU3RhdGUgQnVpbGRpbmcgbGlnaHQgdXAgYXQgbmlnaHQ/XCIiLCAiU3VwcG9ydGluZyI6IFt7ImlkIjogIjAwMDAxNDAxIiwgInVybCI6ICJodHRwczovL3VwbG9hZC53aWtpbWVkaWEub3JnL3dpa2lwZWRpYS9jb21tb25zL3RodW1iLzIvMmIvVGhlX0VtcGlyZV9TdGF0ZV9CdWlsZGluZ19TaGluZXNfQmx1ZV9mb3JfTVRBX1dvcmtlcnNfJTI4NDk4Mzc2NDUwNDElMjkuanBnLzgwMHB4LVRoZV9FbXBpcmVfU3RhdGVfQnVpbGRpbmdfU2hpbmVzX0JsdWVfZm9yX01UQV9Xb3JrZXJzXyUyODQ5ODM3NjQ1MDQxJTI5LmpwZyIsICJwYWdlIjogImh0dHBzOi8vY29tbW9ucy53aWtpbWVkaWEub3JnL3dpa2kvRmlsZTpUaGVfRW1waXJlX1N0YXRlX0J1aWxkaW5nX1NoaW5lc19CbHVlX2Zvcl9NVEFfV29ya2Vyc18lMjg0OTgzNzY0NTA0MSUyOS5qcGciLCAidGl0bGUiOiAiVGhlIEVtcGlyZSBTdGF0ZSBCdWlsZGluZyBTaGluZXMgQmx1ZSBmb3IgTVRBIFdvcmtlcnMgKDQ5ODM3NjQ1In1dfSwgeyJRdHlwZSI6ICJ0ZXh0IiwgIlF1ZXN0aW9uIjogIldoYXQgam9icyBkaWQgSmFtZXMgTXllcnMgVGhvbXBzb24gZG8gZHVyaW5nIGhpcyBsaWZlPyIsICJTdXBwb3J0aW5nIjogW3siZmFjdCI6ICJUaG9tcHNvbiBqb2luZWQgdGhlIENvbW11bmlzdCBQYXJ0eSBpbiAxOTM1IGJ1dCBsZWZ0IHRoZSBncm91cCBieSAxOTM4LiBJbiB0aGUgZWFybHkgc3RhZ2VzIG9mIFdvcmxkIFdhciBJSSwgVGhvbXBzb24gd29ya2VkIGF0IGFuIGFpcmNyYWZ0IGZhY3RvcnkuIEhlIHdhcyBpbnZlc3RpZ2F0ZWQgYnkgdGhlIEZCSSBiZWNhdXNlIG9mIGhpcyBlYXJseSBDb21tdW5pc3QgUGFydHkgYWZmaWxpYXRpb24uIFRoZXNlIGV2ZW50cyB3ZXJlIGZvZGRlciBmb3IgaGlzIHNlbWktYXV0b2Jpb2dyYXBoaWNhbCBkZWJ1dCBub3ZlbCBOb3cgYW5kIG9uIEVhcnRoICgxOTQyKS4iLCAidXJsIjogImh0dHBzOi8vZW4ubS53aWtpcGVkaWEub3JnL3dpa2kvSmltX1Rob21wc29uXyh3cml0ZXIpIiwgInRpdGxlIjogIkppbSBUaG9tcHNvbiAod3JpdGVyKSAtIFdpa2lwZWRpYSJ9LCB7ImZhY3QiOiAiVW5zb3VyY2VkIG1hdGVyaWFsIG1heSBiZSBjaGFsbGVuZ2VkIGFuZCByZW1vdmVkLiBKYW1lcyBNeWVycyBUaG9tcHNvbiAoU2VwdGVtYmVyIDI3LCAxOTA2IFx1MjAxMyBBcHJpbCA3LCAxOTc3KSB3YXMgYW4gQW1lcmljYW4gYXV0aG9yIGFuZCBzY3JlZW53cml0ZXIsIGtub3duIGZvciBoaXMgaGFyZGJvaWxlZCBjcmltZSBmaWN0aW9uIC4gVGhvbXBzb24gd3JvdGUgbW9yZSB0aGFuIHRoaXJ0eSBub3ZlbHMsIHRoZSBtYWpvcml0eSBvZiB3aGljaCB3ZXJlIG9yaWdpbmFsIHBhcGVyYmFjayBwdWJsaWNhdGlvbnMsIHB1Ymxpc2hlZCBmcm9tIHRoZSBsYXRlLTE5NDBzIHRocm91Z2ggbWlkLTE5NTBzLiIsICJ1cmwiOiAiaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSmltX1Rob21wc29uXyUyOHdyaXRlciUyOSIsICJ0aXRsZSI6ICJKaW0gVGhvbXBzb24gKHdyaXRlcikgLSBXaWtpcGVkaWEifV0sICJHdWlkIjogIjhjMDMwZDJlLWZiZWQtNGUyYi1iNzg3LWIxODQxNjJmZGYzYiJ9LCB7IlF0eXBlIjogImltZy1NdWx0aWhvcCIsICJRdWVzdGlvbiI6ICJcIkRvZXMgVmluY2VudCB2YW4gR29naCB3ZWFyIHRoZSBzYW1lIGNvbG9yIGphY2tldCBpbiBib3RoIGhpcyAxODg5IHNlbGYgcG9ydHJhaXQgYW5kIGhpcyAxODg3IFNlbGYtUG9ydHJhaXQgd2l0aCBTdHJhdyBIYXQ/XCIiLCAiU3VwcG9ydGluZyI6IFt7ImlkIjogIjAwMDE0MDY3IiwgInVybCI6ICJodHRwczovL3VwbG9hZC53aWtpbWVkaWEub3JnL3dpa2lwZWRpYS9jb21tb25zL3RodW1iLzUvNTAvVmluY2VudF9WYW5fR29naCUyQ19hdXRvcml0cmF0dG8lMkNfMTg4OSUyQ18wMy5KUEcvNDAwcHgtVmluY2VudF9WYW5fR29naCUyQ19hdXRvcml0cmF0dG8lMkNfMTg4OSUyQ18wMy5KUEciLCAicGFnZSI6ICJodHRwczovL2NvbW1vbnMud2lraW1lZGlhLm9yZy93aWtpL0ZpbGU6VmluY2VudF9WYW5fR29naCUyQ19hdXRvcml0cmF0dG8lMkNfMTg4OSUyQ18wMy5KUEciLCAidGl0bGUiOiAiVmluY2VudCBWYW4gR29naCwgYXV0b3JpdHJhdHRvLCAxODg5LCAwMyJ9LCB7ImlkIjogIjAwMDE0NzYwIiwgInVybCI6ICJodHRwczovL3VwbG9hZC53aWtpbWVkaWEub3JnL3dpa2lwZWRpYS9jb21tb25zL3RodW1iL2EvYTgvVmFuX0dvZ2hfU2VsZi1Qb3J0cmFpdF93aXRoX1N0cmF3X0hhdF8xODg3LU1ldHJvcG9saXRhbi5qcGcvNDc0cHgtVmFuX0dvZ2hfU2VsZi1Qb3J0cmFpdF93aXRoX1N0cmF3X0hhdF8xODg3LU1ldHJvcG9saXRhbi5qcGciLCAicGFnZSI6ICJodHRwczovL2NvbW1vbnMud2lraW1lZGlhLm9yZy93aWtpL0ZpbGU6VmFuX0dvZ2hfU2VsZi1Qb3J0cmFpdF93aXRoX1N0cmF3X0hhdF8xODg3LU1ldHJvcG9saXRhbi5qcGciLCAidGl0bGUiOiAiVmFuIEdvZ2ggU2VsZi1Qb3J0cmFpdCB3aXRoIFN0cmF3IEhhdCAxODg3LU1ldHJvcG9sIn1dfV0=";
				var data;
				try {
					data = JSON.parse(atob(input));
				}
				catch {
					data = JSON.parse(atob(sample_data));
				}
				var annotation_template = document.getElementsByName("template")[0].content;
				while (annotation_template.nodeName != "DIV") {
					annotation_template = annotation_template.firstElementChild;
				}

				var text_template = document.getElementsByName("text_template")[0].content.firstElementChild;
				while (text_template.nodeName != "DIV") {
					text_template = text_template.firstElementChild;
				}

				var image_template = document.getElementsByName("image_template")[0].content.firstElementChild;
				while (image_template.nodeName != "DIV") {
					image_template = image_template.firstElementChild;
				}

				var annotation_container = document.getElementById("AnnotationContainer");
				for (var i = 0; i < data.length; i++) {
					var annotation = annotation_template.cloneNode(true);
					var type = data[i].Qtype;
					var question = data[i].Question;
					var facts = data[i].Supporting;
					annotation.getElementsByClassName("annotation-answer")[0].name = "answer" + (i + 1);
					annotation.getElementsByClassName("annotation-question")[0].innerText = question;
					annotation.getElementsByClassName("MissingFacts")[0].name = "MissingFacts" + (i + 1);
					annotation.getElementsByClassName("DoubleChecked")[0].name = "DoubleChecked" + (i + 1);
					annotation.getElementsByClassName("annotation_index")[0].innerText = i + 1;
					// assign name to the textarea
					if (type.startsWith("img")) {
						for (var j = 0; j < facts.length; j++) {
							var template = image_template.cloneNode(true);
							template.getElementsByClassName("card-header")[0].innerText = "Image " + (j + 1);
							template.getElementsByClassName("image")[0].src = facts[j].url;
							template.getElementsByClassName("image")[0].alt = facts[j].title;
							template.getElementsByClassName("title")[0].innerText = facts[j].title;
							template.getElementsByClassName("title")[0].href = facts[j].page;
							annotation.getElementsByClassName("facts_container")[0].appendChild(template)
						}
					}
					else {
						for (var j = 0; j < facts.length; j++) {
							var template = text_template.cloneNode(true);
							template.getElementsByClassName("card-header")[0].innerText = "Fact " + (j + 1);
							template.getElementsByClassName("fact")[0].innerText = facts[j].fact;
							var link = template.getElementsByClassName("url")[0];
							link.href = facts[j].url;
							link.innerText = facts[j].title;
							annotation.getElementsByClassName("facts_container")[0].appendChild(template)
						}
					}
					annotation_container.appendChild(annotation);
				}


			}

			function replace(str) {
				var args = arguments;
				return str.replace(/{(\d+)}/g, function (match, number) {
					return typeof args[number] != 'undefined'
						? args[number]
						: match
						;
				});
			}

			function disable(element) {
				var text_area = element.previousElementSibling;
				if (!element.checked == true) {
					text_area.removeAttribute("required");
					text_area.setAttribute("disabled", "");
					element.checked = false;
				}
				else {
					text_area.setAttribute("required", "");
					text_area.removeAttribute("disabled");
					element.checked = true;
				}
			}
		</script>
	</section>
	<div>
		<div class="container-fluid" style="height:95%">
			<!-- Header -->
			<h1 style="margin:5px;height:5vh;white-space: nowrap;">Writing textual queries whose answer can be derived
				from
				multiple distinct image/text facts</h1>
			<div class="row" style="height:100%">
				<!-- Side Panel -->
				<div class="col-2" style="padding:10px;">
					<nav id="navbar" class="avbar navbar-light bg-light">
						<a class="navbar-brand" href="#"></a>
						<nav class="nav nav-pills flex-column" style="padding:10px;">
							<a class="nav-link btn btn-outline-secondary" data-toggle="modal"
								data-target="#InstructionModel" id="id-navbar-instruction"
								style="margin:10px;">Instructions</a>
							<div class="modal fade" id="InstructionModel" tabindex="-1" role="dialog"
								aria-labelledby="exampleModalCenterTitle" aria-hidden="true" height="1200">
								<div class="modal-dialog modal-xl" height="100%">
									<div class="modal-content" style="height:90%;">
										<div class="modal-header">
											<h5 class="modal-title" id="exampleModalLongTitle">Instructions</h5>
											<button type="button" class="close" data-dismiss="modal" aria-label="Close">
												<span aria-hidden="true">&times;</span>
											</button>
										</div>
										<div class="modal-body" height="100%">
											<!-- Instruction hyperlink-->
											<iframe frameborder="0" height="100%" width="100%"
												src="https://quantusproject.github.io/Hitapp/AnswerGenerationTextImage/instruction.html"></iframe>
										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-secondary"
												data-dismiss="modal">Close</button>

										</div>
									</div>
								</div>
							</div>
							<h5>A valid annotation should include:</h5>
							<ol>
								<li>Information from the link provided can be used in the question only <b>if the fact has
									that information fully contained</b>. If information is missing then Please mark the
									question as "Can't answer this question due to missing or extra facts"</li>
								<li><b>Answer in fully formed sentences are preferable.</b></li>
								<li><b style="color:orange;">Make sure your questions are not just Yes/No variations or Comparison type of
									questions.</b></li>
								<li>Make sure the answer is derived from all facts/image provided. If extra fact is
									given, then mark the question as "Can't answer this question due to missing or extra
									facts"</li>
							</ol>
						</nav>
					</nav>

				</div>
				<!-- Main Panel -->
				<div class="col-10" data-spy="scroll" data-target="#navbar" data-offset="10" tabindex="0"
					style="overflow-x: hidden; overflow-y: scroll; height:90%; padding:10;"
					onscroll="setTimeout(check_nav,100);" onmove="console.log('on move')" id="Annotations">
					<!-- Announcement -->
					<section class="row" id="Anncoucement">
						<iframe frameborder="0" style="width:100%;height:150;"
							src="https://quantusproject.github.io/Hitapp/AnswerGenerationTextImage/announcement.html"></iframe>
					</section>
					<section class="row">
						<div class="col-12"><br />
							<div id="AnnotationContainer">

							</div>
						</div>
					</section>
					<div id="AnnotationContainer">

					</div>
					<input class="btn btn-primary btn-lg pull-right" id="submitButton" type="submit" value="Submit" /></div>
				</div>


			</div>
		</div>
		<template name="template">
			<div>
				<div style="margin-top:50px; margin-bottom:10px;">
					<font size="4"><b>Annotation </b><b class="annotation_index"></b></font>
				</div>
				<table class="table table-light table-responsive" style="width:100%;overflow: visible;">
					<tbody>
						<tr class="annotation_table">
							<td width="10%"><b>
									<font color="green">Text facts</font>
								</b></td>

							<td style="text-align: center;" width="100%">
								<div class="facts_container row row-cols-md-3 g-4">

								</div>
							</td>
						</tr>
						<tr>
							<td><b>
									<font color="blue">Question</font>
								</b></td>
							<td>
								<p class="annotation-question"></p>
							</td>
						</tr>
						<tr>
							<td><b>
									<font color="red">Answer:</font>
								</b></td>
							<td><textarea class="form-control annotation-answer"
									onclick="ResetAnswerCheck('confirmation');" required="" rows="2"
									type="text"></textarea>
								<crowd-checkbox style="margin-top:5px;" class="MissingFacts" onclick="disable(this)">
									Can't answer this question due to missing/extra facts</crowd-checkbox>
							</td>
						</tr>
						<tr>
							<td colspan="2">
								<crowd-checkbox class="DoubleChecked" required="">I have doubled checked that my response
									fullfill the requirements</crowd-checkbox>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</template>

		<template name="text_template">
			<div class="col" style="min-width:20%">
				<div class="card mb-3" style="max-width: 30rem;">
					<div class="card-header bg-transparent">
					</div>
					<div class="card-body">
						<p class="card-text fact"></p>
					</div>
					<div class="card-footer">
						<a class="text-muted url" href="" target="_blank"></a>
					</div>
				</div>
			</div>
		</template>

		<template name="image_template">
			<div class="col" style="min-width:20%">
				<div class="card mb-3" style="width:520px;">
					<div class="card-header bg-transparent">
					</div>
					<div class="card-body" style="width:520px;">
						<img class="image" width="480;">
					</div>
					<div class="card-footer">
						<a class="title" href="" target="_blank"></a>
					</div>
				</div>
			</div>
		</template>
		<script type="text/javascript">
			loading_data();
		</script>
</crowd-form>